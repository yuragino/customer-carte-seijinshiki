<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>お客様カルテ - 成人式登録フォーム</title>
  <!-- Custom Script -->
  <script type="module" src="./js/form.js"></script>
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"></script>
  <!-- Styles -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/sanitize.css">
  <link rel="stylesheet" href="./css/layout.css">
  <link rel="stylesheet" href="./css/form.css">
</head>

<body x-data="app">
  <header class="header">
    <div class="header-inner">
      <h1 class="header-title"><a :href="`./index.html?year=${selectedYear}`">お客様カルテ</a></h1>
      <div class="header-controls">
        <select x-model.number="selectedYear">
          <template x-for="year in yearOptions" :key="year">
            <option :value="year" x-text="year" :selected="year === selectedYear"></option>
          </template>
        </select>
        <span>花火大会</span>
      </div>
      <nav class="header-nav">
        <a :href="`./image-carte.html?year=${selectedYear}`">画像一覧</a>
        <a :href="`./form.html?year=${selectedYear}`">新規登録</a>
      </nav>
    </div>
  </header>

  <main>

    <!-- 基本情報 -->
    <div class="card">
      <h2><i class="fa-regular fa-circle-user"></i> 基本情報</h2>
      <div class="form-row"><label>予約受付日</label><input type="date" x-model="formData.basic.reservationDate"></div>
      <div class="form-row"><label>名前</label><input type="text" placeholder="山田 花子" x-model="formData.basic.name"></div>
      <div class="form-row"><label>フリガナ</label><input type="text" placeholder="ヤマダ ハナコ" x-model="formData.basic.kana">
      </div>
      <div class="form-row"><label>紹介者</label><input type="text" x-model="formData.basic.introducer"></div>
      <div class="form-row"><label>電話番号</label><input type="tel" placeholder="09012345678"
          x-model="formData.basic.phone"></div>
      <div class="form-row">
        <label>LINE 種別</label>
        <div class="radio-group">
          <label><input type="radio" value="教室LINE" x-model="formData.basic.lineType"> 教室LINE</label>
          <label><input type="radio" value="椿LINE" x-model="formData.basic.lineType"> 椿LINE</label>
          <label><input type="radio" value="お客様LINE" x-model="formData.basic.lineType"> お客様LINE</label>
        </div>
      </div>
      <div class="form-row"><label>住所</label><input type="text" x-model="formData.basic.address"></div>
      <div class="form-row"><label>振袖</label>
        <div class="radio-group">
          <label><input type="radio" value="自前" x-model="formData.basic.furisodeType"> 自前</label>
          <label><input type="radio" value="レンタル" x-model="formData.basic.furisodeType"> レンタル</label>
          <label><input type="radio" value="一部レンタル" x-model="formData.basic.furisodeType"> 一部レンタル</label>
        </div>
      </div>
      <div class="form-row"><label>振袖メモ</label><textarea rows="2" x-model="formData.basic.furisodeMemo"></textarea>
      </div>
      <div class="form-row"><label>身長</label>
        <div class="inline-unit"><input type="number" x-model="formData.basic.height"><span>cm</span></div>
      </div>
      <div class="form-row"><label>足サイズ</label>
        <div class="inline-unit"><input type="number" x-model="formData.basic.footSize"><span>cm</span></div>
      </div>
    </div>

    <!-- 打ち合わせ・預かり -->
    <div class="card">
      <h2>
        <i class="fa-regular fa-calendar-days"></i> 打ち合わせ・預かり
        <span class="title-actions"><button class="btn" @click="openMeetingModal()">+ 追加</button></span>
      </h2>
      <div>
        <template x-for="(item, index) in sortedMeetings" :key="index">
          <div class="meeting-entry">
            <div><strong x-text="item.type"></strong></div>
            <div>
              <span x-text="formatDisplayDate(item.date) + ' @' + item.place + ' - ' + item.note"></span>
              <span class="entry-actions">
                <button class="btn-edit" @click="editMeeting(index)"><i class="fa-solid fa-pen"></i></button>
                <button class="btn-del" @click="deleteMeeting(index)"><i class="fa-solid fa-trash"></i></button>
              </span>
            </div>
          </div>
        </template>
      </div>

      <!-- モーダル -->
      <div x-show="meetingModalVisible" class="modal-bg" @click.self="closeMeetingModal()">
        <div class="modal-box">
          <i class="fa-solid fa-xmark close-btn" @click="closeMeetingModal()"></i>
          <div class="form-row">
            <label>種別</label>
            <div class="radio-group">
              <label><input type="radio" value="預かり" x-model="meetingForm.type"> 預かり</label>
              <label><input type="radio" value="打ち合わせ" x-model="meetingForm.type"> 打ち合わせ</label>
            </div>
          </div>
          <div class="form-row"><label>日時</label>
            <div><input type="datetime-local" x-model="meetingForm.date"><span class="weekday"
                x-text="getWeekday(meetingForm.date)"></span></div>
          </div>
          <div class="form-row"><label>場所</label><input type="text" x-model="meetingForm.place"></div>
          <div class="form-row"><label>備考</label><textarea x-model="meetingForm.note"></textarea></div>
          <div class="modal-actions">
            <button class="btn" @click="saveMeeting()">保存</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 前撮り -->
    <div class="card">
      <h2>
        <i class="fa-solid fa-camera-retro"></i> 前撮り
        <span class="title-actions" x-show="!formData.maedori"><button class="btn" @click="openMaedoriModal()">+
            登録</button></span>
        <span class="title-actions" x-show="formData.maedori">
          <button class="btn-border" @click="editMaedori()"><i class="fa-solid fa-pen"></i> 編集</button>
          <button class="btn-border" @click="deleteMaedori()"><i class="fa-solid fa-trash"></i> 削除</button>
        </span>
      </h2>
      <div x-show="formData.maedori">
        <div><strong>種類:</strong> <span x-text="formData.maedori.type"></span></div>
        <div><strong>カメラマン:</strong> <span x-text="formData.maedori.camera"></span></div>
        <div><strong>撮影日:</strong> <span x-text="formData.maedori.date"></span></div>
        <div><strong>ヘア時間:</strong> <span x-text="formData.maedori.hairStart+'〜'+formData.maedori.hairEnd"></span></div>
        <div><strong>着付け時間:</strong> <span
            x-text="formData.maedori.kitsukeStart+'〜'+formData.maedori.kitsukeEnd"></span></div>
        <div><strong>撮影時間:</strong> <span x-text="formData.maedori.shootStart+'〜'+formData.maedori.shootEnd"></span>
        </div>
        <div><strong>着付け場所:</strong> <span x-text="formData.maedori.place"></span></div>
        <div><strong>ヘア・メイク担当:</strong> <span x-text="formData.maedori.hmStaff"></span></div>
        <div><strong>備考:</strong> <span x-text="formData.maedori.note"></span></div>
      </div>

      <!-- モーダル -->
      <div x-show="maedoriModalVisible" class="modal-bg" @click.self="closeMaedoriModal()">
        <div class="modal-box">
          <i class="fa-solid fa-xmark close-btn" @click="closeMaedoriModal()"></i>
          <div class="form-row"><label>種類</label><select x-model="maedoriForm.type">
              <option>スタジオ</option>
              <option>ロケ</option>
              <option>スタジオ＆ロケ</option>
            </select></div>
          <div class="form-row"><label>カメラマン</label><input type="text" x-model="maedoriForm.camera"></div>
          <div class="form-row"><label>撮影日</label><input type="date" x-model="maedoriForm.date"></div>
          <div class="form-row"><label>ヘア時間</label><input type="time" x-model="maedoriForm.hairStart">〜<input
              type="time" x-model="maedoriForm.hairEnd"></div>
          <div class="form-row"><label>着付け時間</label><input type="time" x-model="maedoriForm.kitsukeStart">〜<input
              type="time" x-model="maedoriForm.kitsukeEnd"></div>
          <div class="form-row"><label>撮影時間</label><input type="time" x-model="maedoriForm.shootStart">〜<input
              type="time" x-model="maedoriForm.shootEnd"></div>
          <div class="form-row"><label>着付け場所</label><input type="text" x-model="maedoriForm.place"></div>
          <div class="form-row"><label>ヘアメイク担当</label><input type="text" x-model="maedoriForm.hmStaff"></div>
          <div class="form-row"><label>備考</label><textarea x-model="maedoriForm.note"></textarea></div>
          <div class="modal-actions">
            <button class="btn" @click="saveMaedori()">保存</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 見積もり -->
    <div class="card">
      <h2>
        <i class="fa-solid fa-yen-sign"></i> 見積もり
        <span class="title-actions"><button class="btn" @click="addOption()">+ オプション追加</button></span>
      </h2>
      <table>
        <tr>
          <th>項目</th>
          <th>当日</th>
          <th>前撮り</th>
          <th>金額</th>
          <th></th>
        </tr>
        <template x-for="(item,i) in estimateItems" :key="i">
          <tr>
            <td>
              <template x-if="item.fixed"><span x-text="item.name"></span></template>
              <template x-if="!item.fixed"><input type="text" x-model="item.name"></template>
            </td>
            <td><input type="checkbox" x-model="item.toujitsu"></td>
            <td><input type="checkbox" x-model="item.maedori"></td>
            <td>
              <template x-if="item.fixed">
                <div class="total"><span x-text="calcPrice(item)"></span></div>
              </template>
              <template x-if="!item.fixed"><input type="number" x-model.number="item.price"></template>
            </td>
            <td><button class="btn-del" x-show="!item.fixed" @click="estimateItems.splice(i,1)"><i
                  class="fa-solid fa-trash"></i></button></td>
          </tr>
        </template>
      </table>
      <div class="form-row"><label>領収日</label><input type="date" x-model="formData.estimate.receiptDate"></div>
      <div class="total">合計: ¥<span x-text="totalAmount"></span></div>
    </div>

    <div class="actions"><button class="btn register-btn">登録</button></div>

  </main>
</body>

</html>